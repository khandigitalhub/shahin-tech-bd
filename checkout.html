<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout</title>

<style>
body{
font-family:Arial;
background:#f2f2f2;
padding:10px;
padding-bottom:100px;
}

.card{
background:#fff;
padding:15px;
border-radius:15px;
margin-bottom:15px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.product{
display:flex;
gap:10px;
margin-bottom:10px;
}

.product img{
width:70px;
border-radius:8px;
}

.total-box{
background:#fff3e0;
padding:12px;
border-radius:12px;
margin-top:10px;
}

select{
width:100%;
padding:10px;
border-radius:8px;
margin-top:5px;
}

button{
background:#ff3d00;
color:#fff;
padding:14px;
border:none;
width:100%;
border-radius:10px;
font-size:16px;
margin-top:15px;
}
</style>
</head>

<body>

<h2>Checkout</h2>

<div class="card" id="userBox"></div>

<div class="card">
<h3>Order Summary</h3>
<div id="productList"></div>
</div>

<div class="card">
<h3>Delivery Option</h3>

<select id="delivery" onchange="updateTotal()">
<option value="50">‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá - ‡ß≥50</option>
<option value="80">‡¶ú‡ßá‡¶≤‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá - ‡ß≥80</option>
<option value="120">‡¶∏‡¶æ‡¶∞‡¶æ‡¶¶‡ßá‡¶∂‡ßá - ‡ß≥120</option>
</select>

<div class="total-box">
<p>Subtotal: ‡ß≥<span id="subtotal">0</span></p>
<p>Delivery: ‡ß≥<span id="deliveryCharge">50</span></p>
<h3>Grand Total: ‡ß≥<span id="grandTotal">0</span></h3>
</div>

</div>

<button onclick="confirmOrder()">Confirm Order</button>

<script>

let user=JSON.parse(localStorage.getItem("user"));

if(!user){
alert("‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
window.location="account.html";
}

document.getElementById("userBox").innerHTML=`
<b>${user.name}</b><br>
üìû ${user.phone}<br>
${user.whatsapp ? "WhatsApp: "+user.whatsapp+"<br>" : ""}
${user.altphone ? "Alt: "+user.altphone+"<br>" : ""}
üìç ${user.address}, ${user.upazila}, ${user.district}
`;

let buyNow=JSON.parse(localStorage.getItem("buyNowProduct"));
let cart=JSON.parse(localStorage.getItem("cart"))||[];

let products=[];
if(buyNow){
products=[buyNow];
localStorage.removeItem("buyNowProduct");
}else{
products=cart;
}

let subtotal=0;
let list=document.getElementById("productList");

products.forEach(p=>{
let totalPrice=p.newprice * p.qty;
subtotal+=totalPrice;

list.innerHTML+=`
<div class="product">
<img src="${p.image}">
<div>
<b>${p.name}</b><br>
Qty: ${p.qty}<br>
‡ß≥${p.newprice} √ó ${p.qty} = ‡ß≥${totalPrice}
</div>
</div>`;
});

document.getElementById("subtotal").innerText=subtotal;

function updateTotal(){
let delivery=Number(document.getElementById("delivery").value);
document.getElementById("deliveryCharge").innerText=delivery;
document.getElementById("grandTotal").innerText=subtotal+delivery;
}

updateTotal();

function confirmOrder(){

let delivery=Number(document.getElementById("delivery").value);
let grandTotal=subtotal+delivery;

let orders=JSON.parse(localStorage.getItem("orders"))||[];

orders.push({
user:user,
products:products,
subtotal:subtotal,
delivery:delivery,
total:grandTotal,
date:new Date().toLocaleString()
});

localStorage.setItem("orders",JSON.stringify(orders));
localStorage.removeItem("cart");

window.location="payment.html";
}

</script>

</body>
</html>
