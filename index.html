<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f5f5f5}
header{background:#ff6a00;padding:10px;color:white;display:flex;align-items:center;justify-content:space-between}
.logo{font-size:20px;font-weight:bold}
.search-box input{padding:7px;width:220px;border:none;border-radius:4px}
.cart-btn{cursor:pointer;font-weight:bold}
.banner{background:linear-gradient(45deg,#ff6a00,#ffb347);color:white;padding:40px;text-align:center;font-size:24px}
.categories{display:flex;overflow:auto;background:white;padding:10px}
.categories div{margin-right:15px;cursor:pointer;font-weight:bold}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;padding:10px}
.card{background:white;padding:10px;border-radius:6px}
.card img{width:100%;height:140px;object-fit:cover}
.card button{background:#ff6a00;color:white;border:none;padding:6px;width:100%;margin-top:5px;cursor:pointer}
.hidden{display:none}
.cart-page{padding:10px}
.cart-item{background:white;padding:10px;margin-bottom:8px}
.qty-btn{padding:3px 7px;background:#ff6a00;color:white;border:none}
.checkout-box{background:white;padding:10px;margin-top:10px}
input,select{padding:7px;width:100%;margin-bottom:8px}
.success{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);
background:white;padding:20px;border-radius:8px;display:none}
</style>
</head>
<body>

<header>
<div class="logo">Smart Shop</div>
<div class="search-box"><input type="text" id="search" placeholder="Search products..."></div>
<div class="cart-btn" onclick="showCart()">üõí Cart (<span id="cartCount">0</span>)</div>
</header>

<div class="banner">
Welcome to Smart Shop ‚Äì Best Online Deals
</div>

<div class="categories" id="categories"></div>

<div class="products" id="productList"></div>

<div class="cart-page hidden" id="cartPage"></div>

<div class="success" id="successBox">
<h3>üéâ Order Confirmed!</h3>
<p>‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§</p>
<button onclick="closeSuccess()">OK</button>
</div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbxsJm5bOqhSJSbT-mrhlCV4lBAhNvWuL5HiejIYH7GrqUo-M4wg7DXm29ePapMot2iq/exec";
let products=[];
let cart=[];

fetch(scriptURL)
.then(res=>res.json())
.then(data=>{
products=data;
loadCategories();
displayProducts(products);
});

function normalize(obj){
let newObj={};
for(let key in obj){
newObj[key.toLowerCase()]=obj[key];
}
return newObj;
}

function loadCategories(){
let cats=[...new Set(products.map(p=>normalize(p).category))];
let html='<div onclick="displayProducts(products)">All</div>';
cats.forEach(c=>{
html+=`<div onclick="filterCategory('${c}')">${c}</div>`;
});
document.getElementById("categories").innerHTML=html;
}

function filterCategory(cat){
let filtered=products.filter(p=>normalize(p).category==cat);
displayProducts(filtered);
}

function displayProducts(list){
let html="";
list.forEach(p=>{
let pr=normalize(p);
html+=`
<div class="card">
<img src="${pr.image}">
<h4>${pr.name}</h4>
<p>‡ß≥${pr.price}</p>
<button onclick="addToCart('${pr.id}','${pr.name}',${pr.price},'${pr.image}')">Add to Cart</button>
</div>`;
});
document.getElementById("productList").innerHTML=html;
}

function addToCart(id,name,price,image){
let found=cart.find(item=>item.id==id);
if(found){found.qty++}
else{cart.push({id,name,price,image,qty:1})}
updateCartCount();
}

function updateCartCount(){
document.getElementById("cartCount").innerText=cart.reduce((a,b)=>a+b.qty,0);
}

function showCart(){
document.getElementById("cartPage").classList.remove("hidden");
let html="";
let subtotal=0;
cart.forEach(item=>{
subtotal+=item.price*item.qty;
html+=`
<div class="cart-item">
<img src="${item.image}" width="60">
<b>${item.name}</b>
<p>‡ß≥${item.price} x ${item.qty}</p>
<button class="qty-btn" onclick="changeQty('${item.id}',-1)">-</button>
<button class="qty-btn" onclick="changeQty('${item.id}',1)">+</button>
</div>`;
});
html+=`
<div class="checkout-box">
<p>Subtotal: ‡ß≥${subtotal}</p>
<select id="area" onchange="updateTotal(${subtotal})">
<option value="50">‡¶ú‡¶≤‡¶¢‡¶æ‡¶ï‡¶æ (50)</option>
<option value="75">‡¶®‡ßÄ‡¶≤‡¶´‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ (75)</option>
<option value="120">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ (120)</option>
</select>
<p>Total: ‡ß≥<span id="finalTotal">${subtotal+50}</span></p>
<h4>Checkout</h4>
<input id="customername" placeholder="Your Name">
<input id="phone" placeholder="Phone">
<input id="address" placeholder="Address">
<button onclick="placeOrder(${subtotal})">Confirm Order</button>
</div>`;
document.getElementById("cartPage").innerHTML=html;
}

function changeQty(id,change){
let item=cart.find(i=>i.id==id);
item.qty+=change;
if(item.qty<=0){cart=cart.filter(i=>i.id!=id)}
showCart();
updateCartCount();
}

function updateTotal(subtotal){
let delivery=parseInt(document.getElementById("area").value);
document.getElementById("finalTotal").innerText=subtotal+delivery;
}

function placeOrder(subtotal){
let delivery=parseInt(document.getElementById("area").value);
let total=subtotal+delivery;

let productlist=cart.map(i=>`${i.name} (${i.qty}pcs)`).join(", ");

let formData=new FormData();
formData.append("customername",document.getElementById("customername").value);
formData.append("phone",document.getElementById("phone").value);
formData.append("address",document.getElementById("address").value);
formData.append("productlist",productlist);
formData.append("subtotal",subtotal);
formData.append("delivery",delivery);
formData.append("total",total);

fetch(scriptURL,{method:"POST",body:formData})
.then(res=>res.text())
.then(()=>{
cart=[];
updateCartCount();
document.getElementById("cartPage").classList.add("hidden");
document.getElementById("successBox").style.display="block";
});
}

function closeSuccess(){
document.getElementById("successBox").style.display="none";
}

document.getElementById("search").addEventListener("input",function(){
let value=this.value.toLowerCase();
let filtered=products.filter(p=>normalize(p).name.toLowerCase().includes(value));
displayProducts(filtered);
});

</script>

</body>
</html>
